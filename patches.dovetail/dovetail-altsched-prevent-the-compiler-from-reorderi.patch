From e507a0384f52a351ae48e528cbf2849eae62c134 Mon Sep 17 00:00:00 2001
From: Philippe Gerum <rpm@xenomai.org>
Date: Mon, 12 Aug 2019 12:12:38 +0200
Subject: [PATCH] dovetail: altsched: prevent the compiler from reordering past
 switch_to()

---
 kernel/sched/core.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/kernel/sched/core.c b/kernel/sched/core.c
index 34ecd29d8a25..7956d875f297 100644
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -8098,6 +8098,7 @@ bool dovetail_context_switch(struct dovetail_altsched_context *out,
 	}
 
 	switch_to(prev, next, last);
+	barrier();
 
 	if (check_hard_irqs_disabled())
 		hard_irqs_disabled();
-- 
2.16.4

